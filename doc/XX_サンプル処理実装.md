# サンプル処理実装

<!-- TOC -->

- [サンプル処理実装](#サンプル処理実装)
  - [開発環境準備](#開発環境準備)
    - [ブランチの切替](#ブランチの切替)
    - [npm](#npm)
    - [サンプルテーブルの作成とダミーデータ](#サンプルテーブルの作成とダミーデータ)
  - [サンプル処理について](#サンプル処理について)
    - [機能](#機能)
  - [各自サンプルの作成について](#各自サンプルの作成について)
    - [課題](#課題)
      - [テーブルの作成](#テーブルの作成)
      - [モデルの作成](#モデルの作成)
      - [テストデータの作成](#テストデータの作成)
      - [各画面の実装](#各画面の実装)
    - [発展課題](#発展課題)
      - [commit・push](#commitpush)

<!-- /TOC -->
※沼田さん作成のセレクティー様マイページ用資料を流用しています。  
画面ハードコピーなどは流用元のものになっているものが多いので、適時読み替えてください。  

## 開発環境準備

### ブランチの切替

サンプル処理実装の際は、`sample_study`ブランチに切り替えてください。  
`develop`ブランチでサーバーを起動中の場合は、終了しておいてください。

### npm

VSCodeのターミナルから、以下のコマンドを実行しJSのビルドを行います。
（ファイルに変更がある場合、自動でビルドされる）
ターミナルが実行しっぱなしになるので、他のコマンド打つ場合は別途ターミナルを開いてください。  

```
npm run dev
```
ctrl+Cで終了すると、JSが動かなくなるので注意。  

### サンプルテーブルの作成とダミーデータ

開発環境構築・プロジェクトの読み込みと起動にて、
以下のテーブル作成・データ作成コマンドを実行しており、「samples」テーブルが作成済みであることを確認する。  
（「samples」テーブルは空でもよい）

```
php artisan migrate
php artisan db:seed --class=MypageDummyDataSeeder
```

テーブル未作成の場合は、上記のコマンドを実行しておく。  

以下のコマンドでサーバーを起動します。
このコマンドは実行すると実行しっぱなしになるので、別ターミナルを起動します。
(開発中は、基本的に3つのターミナルが開かれている状態になると思います)

```
php artisan serve
```

## サンプル処理について

### 機能

管理者権限でログイン後、メニュー最下部の「サンプルメニュー」から画面を参照できます。

- サンプル管理モック
　→モックのサンプル
- サンプル画面
　→一覧・詳細表示・新規登録・編集・削除の実装サンプル
- サンプル画面2
　→一覧・詳細表示・モーダルフォーム（更新）・新規登録・編集・削除の実装サンプル

マスタ管理のようなCRUD機能に大体必要な画面・処理のサンプルとなります。

- 一覧画面
  - 検索フォーム
  - ページネータ
  - 詳細表示（モーダル）
  - （モーダルフォーム）※サンプル画面2
- 新規登録画面
  - バリデーション
  - 新規登録
- 編集画面
  - バリデーション
  - 編集
  - 削除

新規登録・編集画面ではフォームの入力項目がある程度揃っています。

- カレンダーピッカー(日付入力)
- テキストボックス
- プルダウン(select2)

など

![](./img/05_サンプル処理実装/02.png)


## 各自サンプルの作成について

まず以下を確認してください。

[06_処理の実装について.md](06_処理の実装について.md)  
[08_処理の実装について.md](08_処理の実装について.md)

### 課題

各自、サンプル画面を元に各自のサンプル画面を作成してください。  
機能はサンプル画面同様です。  
以降、tobaを各自の名前に置き換えて読んでください。

例：サンプルのURLに名前をつける  
http://localhost:8000/sample-toba_mng

項目名やファイル名には必ず`Sample`をつけてください。  

以下手順です。

#### テーブルの作成

`database\migrations`以下に、各自のテーブル用定義ファイルを作成してください。  
（`database\migrations\2025_02_26_000001_create_sample_table.php`を流用）  

例
定義ファイル名：2025_03_01_000000_create_samples-toba_table.php
テーブル名：samples-toba

テーブル項目は任意です。以下のような項目をいくつか入れてみてください。

- text
- Integer
- Date
- DateTime

新規作成日、更新日、論理削除は追加してください。

```
// タイムスタンプ
$table->timestamps();
// 論理削除
$table->softDeletes();
```

以下のコマンドでテーブルができることを確認してください。

```
composer dump-autoload
php artisan migrate
```


#### モデルの作成

`app\Models`配下に、テーブルに対するモデルを作成します。
（`app\Models\Sample.php`を流用）  

例
モデルファイル名：SampleToba.php

以下の$tablesを対象テーブル名に変更してください。
テーブル項目も、対象テーブル項目に合わせて変更してください。

```
    protected $table = 'samples-toba';
```


#### テストデータの作成

（※まとまった件数のテストデータを作成したい場合のみ）  
fakerを使用して、ダミーのテストデータを作成します。  

以下のファイルを参考に、自分のファイルを作成してください。  
`\database\factories\SampleFactory.php`  
例：SampleTobaFactory.php


以下のファイルを参考に、自分のファイルを作成してください。  
`\database\seeds\SampleDummyTableSeeder.php`  
例：SampleTobaDummyTableSeeder.php


既存のSeederファイルは変更しないでください。

以下のコマンドでダミーデータが作成されることを確認してください。

```
php artisan db:seed --class=SampleTobaDummyTableSeeder
```

#### 各画面の実装

サンプル画面と同様に、一覧、新規、編集、削除ができるように作成してみましょう。

メニューの追加については、以下のファイルに定義します。
`\config\adminlte.php`  

コントローラーは
以下のファイルを参考に、自分のファイルを作成してください。  
`\app\Http\Controllers\Admin\SampleMngController.php`  

blade、jsファイルについても
`resources\views\pages\admin\sample_mng.blade.php`
や、
`resources\js\pages\admin\sample_mng.js`  
を参考に、自分のファイルを作成してください。  

作成できたら、一覧検索・新規登録・変更登録・削除の処理がひととおり動作するか確認してください。  


### 発展課題

- モック画面の作成  
→サンプル管理モックを参考に。  
/samplemock2-xxx

- 検索項目がない検索一覧画面の作成  
→校舎マスタ管理画面等を参考に。  
/sampleX-xxx

- 検索一覧がない登録画面の作成   
→生徒メニューのパスワード変更画面を参考に。  
/sampleX-xxx

#### commit・push

動作確認ができたら、commit/pushしても構いません。
git操作の練習として。

※カレントブランチが`sample_study`ブランチであることを確認してください。  
`develop`ブランチにはcommit/pushしないでください。  

Github運用については、以下を参照してください。
[09_Github運用ルール・操作手順.md](09_Github運用ルール・操作手順.md)


